sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/format/DateFormat","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet","sap/ui/core/format/NumberFormat"],function(t,e,n,a,o,r,i,l){"use strict";return t.extend("zmb51ui.controller.Main",{onInit:function(){const t=this;const e=this.getView().byId("smartFilterBar");e.attachSearch(function(){console.log(sap.ui.getCore().byId("application-zmb51ui-display-component---Main--smartFilterBar-filterItemControlA_-Article-valueHelpDialog-smartFilterBar-filterItemControlA_-Matnr-valueHelpDialog"));const n=t.getView().byId("BusyDialog");n.open();const a=e.getFilterData().Article;const o=e.getFilterData().GrpMarchandise;const r=e.getFilterData().Division;const i=e.getFilterData().MVT;const l=e.getFilterData().DateComptable;let s=new Array;a&&a.items.map(t=>t.text).map(e=>{s.push(t._onGetFilters(e,"Article"))});o&&o.items.map(t=>t.text).map(e=>{s.push(t._onGetFilters(e,"GrpMarchandise"))});r&&r.items.map(t=>t.text).map(e=>{s.push(t._onGetFilters(e,"Division"))});i&&i.items.map(t=>t.text).map(e=>{s.push(t._onGetFilters(e,"MVT"))});l&&s.push(t._onGetFilters(l,"DateComptable"));const c=t.getOwnerComponent().getModel();c.read("/ZCDS_CN_MSEG",{filters:s,success:function(e){console.log(e);if(e){const a=new sap.ui.model.json.JSONModel(e.results);console.log(e.results);e.results.map(e=>{e.DateComptable=t._formatDate(e.DateComptable);e.QteEnUQS=t._formatNumber(e.QteEnUQS,13,2);e.QteEnUQ=t._formatNumber(e.QteEnUQ,13,3);e.Quantite=t._formatNumber(e.Quantite,13,3);e.MontantAchat=Number(e.MontantAchat)!=0?t._formatNumber(e.MontantAchat,13,2):"";e.UQVar=Number(e.UQVar)!=0?t._formatUQVar(e.UQVar):"";return e});t.getView().byId("title").setText(`${t.getOwnerComponent().getModel("i18n").getResourceBundle().getText("titleTable")} (${e.results.length})`);t.getView().byId("table").setModel(a);n.close()}},error:function(t){console.log("******************************************************** ERROR MSEG CALL ");console.log(t);alert("Error reading data from backend system ! ")}})},{passive:true})},onExtractDataJS:function(){const t=this.getView().byId("BusyDialog");t.open();const e=this.getView().byId("smartFilterBar");const n=this.getView().byId("table");const a=n.getBinding("rows");let r="application/vnd.ms-excel";const i=this.createId("hiddenLink");let l=document.getElementById(i);const s=e.getFilterData().Article;const c=e.getFilterData().GrpMarchandise;const d=e.getFilterData().Division;const p=e.getFilterData().MVT;const h=e.getFilterData().DateComptable;if(!c&&!h){o.show("Aucun des filtres obligatoires n'a été sélectionné.");return}let b=[];s&&s.items.map(t=>t.text).map(t=>{b.push(t)});let m=[];c&&c.items.map(t=>t.text).map(t=>{m.push(t)});let g=[];d&&d.items.map(t=>t.text).map(t=>{g.push(t)});let u=[];p&&p.items.map(t=>t.text).map(t=>{u.push(t)});let x={};if(h){x.min=h.low;x.max=h.high}if(a&&a.getLength()>0){const e=this._onGetHTMLCodeOfExcel(b,m,g,u,x,a.oList);l.href=`data:${r}, ${e}`;l.download=`Extraction-${this._formatDate(new Date)}.xls`;l.click();t.close()}else{o.show("No data bound ");return}},onNavigateMM03:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const a=n&&n.hrefForExternal({target:{semanticObject:"Material",action:"display"},params:{Material:e}})||"";const o=window.location.href.split("#")[0]+a;sap.m.URLHelper.redirect(o,true)},onNavigateF1077:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const a=n&&n.hrefForExternal({target:{semanticObject:"MaterialDocument",action:"displayFactSheet"},params:{MaterialDocument:e}})||"";const o=window.location.href.split("#")[0]+a;sap.m.URLHelper.redirect(o,true)},onNavigateBMBC:function(t){const e=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const n=e&&e.hrefForExternal({target:{semanticObject:"Batch",action:"monitor"}})||"";const a=window.location.href.split("#")[0]+n;sap.m.URLHelper.redirect(a,true)},onNavigateMSC3N:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const a=n&&n.hrefForExternal({target:{semanticObject:"Batch",action:"display"},params:{Batch:e}})||"";const o=window.location.href.split("#")[0]+a;sap.m.URLHelper.redirect(o,true)},onNavigateME23N:function(t){const e=t.getSource().getText();const n=sap.ushell&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");const a=n&&n.hrefForExternal({target:{semanticObject:"ZSO_ME23N",action:"display"},params:{Ebeln:e}})||"";const o=window.location.href.split("#")[0]+a;sap.m.URLHelper.redirect(o,true)},_onGetFilters:function(t,a){if(a=="DateComptable"){console.log(t);const o=new e(a,n.BT,t.low,t.high);return o}else{const o=new e(a,n.EQ,t);return o}},_formatDate:function(t){if(!t){return""}const e=a.getDateInstance({pattern:"dd.MM.yyyy"});return e.format(new Date(t))},_formatNumber:function(t,e,n){var a=t-Math.floor(t)!==0;let o={};o={minIntegerDigits:1,maxIntegerDigits:e,minFractionDigits:n,maxFractionDigits:n};var r=l.getFloatInstance(o);let i=r.format(Number(t));return i},_formatUQVar:function(t){var e=sap.ui.core.format.NumberFormat.getFloatInstance({style:"short",shortDecimals:1});var n=e.format(t);return n},_onGetHTMLCodeOfExcel:function(t,e,n,a,o,r){const i=this.getOwnerComponent().getModel("i18n").getResourceBundle();const l=i.getText("title");const s=this._formatDate(new Date);const c=i.getText("para");let d=`<div id="allfile">\n                                    <div class="container">\n                                    <h3>${l}</h3>\n                                    <p style="margin-bottom: 5px;"><b>Date&nbsp;:</b>&nbsp;${s}</p>\n                                    <p style="margin-bottom: 0;  margin-top: 0px">${c}</p>\n                                    <ul style="margin-top: 3px;">\n                                        <li><strong>Article&nbsp;:</strong>${t.length>0?t.join(","):"Aucun"}</li>\n                                        <li><strong>Groupe de marchandise&nbsp;:</strong>${e.length>0?e.join(","):"Aucun"}</li>\n                                        <li><strong>Division&nbsp;:</strong>${n.length>0?n.join(","):"Aucun"}</li>\n                                        <li><strong>Code MVT&nbsp;:</strong>${a.length>0?a.join(","):"Aucun"}</li>\n                                        <li><strong>Date Comptable&nbsp;:</strong>Du&nbsp;${this._formatDate(o.min)}&nbsp;Au&nbsp;${this._formatDate(o.max)}</li>\n                                    </ul>\n                                    </div>\n                                    <table id="customersTable" style="font-family:arial, sans-serif;border: 1px solid black; border-collapse: collapse;">\n                                    <thead>\n                                        <tr>\n                                            <th style="width: 10em; border: 1px solid black;">Division</th>\n                                            <th style="width: 10em; border: 1px solid black;">Article</th>\n                                            <th style="width: 15em; border: 1px solid black;">Description article</th>\n                                            <th style="width: 15em; border: 1px solid black;">Groupe de marchandise</th>\n                                            <th style="width: 20em; border: 1px solid black;">Description groupe de marchandise</th>\n                                            <th style="width: 10em; border: 1px solid black;">Magasin</th>\n                                            <th style="width: 10em; border: 1px solid black;">MVT</th>\n                                            <th style="width: 10em; border: 1px solid black;">Document article</th>\n                                            <th style="width: 10em; border: 1px solid black;">Poste</th>\n                                            <th style="width: 10em; border: 1px solid black;">Date comptable</th>\n                                            <th style="width: 10em; border: 1px solid black;">${i.getText("QteEnUQS")}</th>\n                                            <th style="width: 10em; border: 1px solid black;">UQ de saisie</th>\n                                            <th style="width: 10em; border: 1px solid black;">Lot fournisseur</th>\n                                            <th style="width: 20em; border: 1px solid black;">${i.getText("LotQualite")}</th>\n                                            <th style="width: 15em; border: 1px solid black;">Qte unite de base (UQ)</th>\n                                            <th style="width: 10em; border: 1px solid black;">UQ de base</th>\n                                            <th style="width: 10em; border: 1px solid black;">Montant achat</th>\n                                            <th style="width: 10em; border: 1px solid black;">Devise</th>\n                                            <th style="width: 10em; border: 1px solid black;">${i.getText("Quantite")}</th>\n                                            <th style="width: 10em; border: 1px solid black;">UQ var</th>\n                                            <th style="width: 10em; border: 1px solid black;">Client</th>\n                                            <th style="width: 10em; border: 1px solid black;">Nom du client</th>\n                                            <th style="width: 10em; border: 1px solid black;">Fournisseur</th>\n                                            <th style="width: 10em; border: 1px solid black;">Document d'achat</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                   \n                                            ${r&&r.map(t=>`<tr>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Division}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Article}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.DescriptionArticle}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.GrpMarchandise}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.DescGrpMarchandise}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Magasin}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.MVT}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.NumeroDoc}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Poste}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.DateComptable}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.QteEnUQS}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.UQDeSaisie}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.LotFournisseur}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.LotQualite}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.QteEnUQ}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.UQDeBase}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.MontantAchat}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Devise}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Quantite}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.UQVar}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.ZClient}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.NomClient}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.Fournisseur}</td>\n                                                            <td style="border: 1px solid black;text-align:center;">${t.CdeAch}</td>                                                            \n                                                        </tr>`).join("")}\n                                            \n                                            \n                                 \n                                    </tbody>\n                                    </table>\n                                </div>\n                                `;let p=`\n                <!DOCTYPE html>\n                <html lang="en">\n                \n                <head>\n                  <meta charset="UTF-8">\n                  <meta http-equiv="X-UA-Compatible" content="IE=edge">\n                  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                  <title>ss</title>\n                </head>\n                <body>\n                    ${d}\n                </body>\n                </html>\n                `;d=p.replace(/ /g,"%20");return d}})});
//# sourceMappingURL=Main.controller.js.map